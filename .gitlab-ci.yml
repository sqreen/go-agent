variables:
  GIT_REPO: github.com/sqreen/go-agent
  GO_PACKAGE_PATH_WITHOUT_GOMODULES: /go/src/$GIT_REPO

go:1.9:
  extends: .test-without-gomodules
  image: golang:1.9

go:1.10:
  extends: .test-without-gomodules
  image: golang:1.10

go:1.11:
  extends: .test
  image: golang:1.11

go:1.12:
  extends: .test
  image: golang:1.12

.test:
  stage: test
  script:
    - make test

.test-without-gomodules:
  extends: .test
  before_script:
    # Prepare the expected GOPATH
    - mkdir -p $(dirname $GO_PACKAGE_PATH_WITHOUT_GOMODULES)
    - ln -s $CI_PROJECT_DIR $GO_PACKAGE_PATH_WITHOUT_GOMODULES
    - cd $GO_PACKAGE_PATH_WITHOUT_GOMODULES
    # Download dependencies, including thos required by the tests
    - go get -t -d -v ./...
